//--README.MD
# SoapBox ğŸ§¼

> **Token-gated XMTP group chats for Empire Builder vault-authorized communities**

SoapBox is a sophisticated decentralized messaging application that combines real-time chat capabilities with blockchain-based authorization, creating exclusive community spaces for token holders and vault participants.

## ğŸ—ï¸ **Architecture Overview**

SoapBox integrates multiple cutting-edge technologies to deliver a seamless Web3 messaging experience:

- **Frontend**: Next.js 15 + React 19 + TypeScript
- **Database**: PostgreSQL + Prisma ORM
- **Caching**: Redis with pub/sub for massive scale (500K-5M users)
- **Real-time**: XMTP SDK + SpacetimeDB for decentralized messaging
- **Blockchain**: Wagmi + Viem + OnchainKit (Base chain)
- **UI**: Tailwind CSS + Shadcn/ui + Radix UI primitives

## ğŸ“ **Project Structure**

```
soapbox/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/                    # Next.js App Router
â”‚   â”‚   â”œâ”€â”€ api/               # Server-side API routes (30+ endpoints)
â”‚   â”‚   â”‚   â”œâ”€â”€ auth/          # Authentication & user management
â”‚   â”‚   â”‚   â”œâ”€â”€ empire-*/      # Empire API integrations
â”‚   â”‚   â”‚   â”œâ”€â”€ rooms/         # Room management & access control
â”‚   â”‚   â”‚   â””â”€â”€ proxy/         # External API proxy
â”‚   â”‚   â”œâ”€â”€ fonts/             # Geist font assets
â”‚   â”‚   â”œâ”€â”€ types/             # Global TypeScript interfaces
â”‚   â”‚   â”œâ”€â”€ globals.css        # Global styles
â”‚   â”‚   â”œâ”€â”€ layout.tsx         # Root layout with providers
â”‚   â”‚   â””â”€â”€ page.tsx           # Main application entry point
â”‚   â”‚
â”‚   â”œâ”€â”€ components/            # React components
â”‚   â”‚   â”œâ”€â”€ ui/               # Shadcn/ui component library (50+ components)
â”‚   â”‚   â”œâ”€â”€ enhanced/         # Enhanced admin & management components
â”‚   â”‚   â”œâ”€â”€ wallet/           # Wallet connection components
â”‚   â”‚   â””â”€â”€ providers.tsx     # Application providers
â”‚   â”‚
â”‚   â”œâ”€â”€ hooks/                 # Custom React hooks
â”‚   â”‚   â”œâ”€â”€ useAuth.ts        # Authentication logic
â”‚   â”‚   â”œâ”€â”€ useXMTPChat.ts    # XMTP messaging integration
â”‚   â”‚   â”œâ”€â”€ useEmpireApi.ts   # Empire API interactions
â”‚   â”‚   â””â”€â”€ useWalletConnect.ts # Wallet connection management
â”‚   â”‚
â”‚   â”œâ”€â”€ lib/                   # Utility libraries & services
â”‚   â”‚   â”œâ”€â”€ services/         # Core business logic (20+ services)
â”‚   â”‚   â”‚   â”œâ”€â”€ prisma.ts     # Database client & operations
â”‚   â”‚   â”‚   â”œâ”€â”€ empireApi.ts  # Empire API service layer
â”‚   â”‚   â”‚   â”œâ”€â”€ realAnalytics.ts # Analytics & monitoring
â”‚   â”‚   â”‚   â””â”€â”€ tokenPricing.ts  # Token price resolution
â”‚   â”‚   â”œâ”€â”€ wagmi/           # Blockchain configuration
â”‚   â”‚   â”œâ”€â”€ redis.ts         # High-performance Redis setup
â”‚   â”‚   â””â”€â”€ utils/           # Utility functions
â”‚   â”‚
â”‚   â”œâ”€â”€ providers/            # Context providers
â”‚   â”‚   â””â”€â”€ XMTPProvider.tsx  # XMTP messaging context
â”‚   â”‚
â”‚   â””â”€â”€ spacetime_module_bindings/ # SpacetimeDB auto-generated bindings
â”‚       â”œâ”€â”€ index.ts          # Main exports
â”‚       â”œâ”€â”€ *_table.ts        # Table interfaces
â”‚       â””â”€â”€ *_reducer.ts      # Reducer functions
â”‚
â”œâ”€â”€ spacetime-server/          # SpacetimeDB Rust backend
â”‚   â””â”€â”€ src/lib.rs            # Database schema & server-side logic
â”‚
â”œâ”€â”€ prisma/                    # Database schema & migrations
â”‚   â””â”€â”€ schema.prisma         # PostgreSQL schema definition
â”‚
â”œâ”€â”€ next.config.js            # Next.js configuration
â”œâ”€â”€ tailwind.config.ts        # Tailwind CSS configuration
â””â”€â”€ package.json              # Dependencies & scripts
```

## ğŸš€ **Getting Started**

### Prerequisites

- **Node.js** 18+ with npm/yarn
- **PostgreSQL** database
- **Redis** server (for scaling)
- **SpacetimeDB** (optional, for real-time features)

### Installation

1. **Clone the repository**
   ```bash
   git clone <your-repo-url>
   cd soapbox
   ```

2. **Install dependencies**
   ```bash
   npm install
   ```

3. **Environment setup**
   ```bash
   cp .env.example .env.local
   ```

4. **Database setup**
   ```bash
   npx prisma migrate dev
   npx prisma generate
   ```

5. **Start development server**
   ```bash
   npm run dev
   ```

## ğŸ”§ **Required Dependencies**

### Core Framework
```json
{
  "next": "15.3.4",
  "react": "19.1.0",
  "react-dom": "19.1.0",
  "typescript": "5.8.3"
}
```

### Blockchain & Web3
```json
{
  "@coinbase/onchainkit": "^0.38.17",
  "@base-org/account": "^1.1.1",
  "@base-org/account-ui": "^1.0.1",
  "wagmi": "^2.16.3",
  "viem": "^2.33.3",
  "@tanstack/react-query": "^5.85.3",
  "@reown/appkit": "^1.7.19",
  "@reown/appkit-adapter-wagmi": "^1.7.19"
}
```

### Messaging & Real-time
```json
{
  "@xmtp/browser-sdk": "^2.0.0",
  "@farcaster/miniapp-sdk": "^0.1.7",
  "@farcaster/miniapp-wagmi-connector": "^1.0.0",
  "@farcaster/quick-auth": "0.0.7",
  "ioredis": "^5.6.1"
}
```

### Database & ORM
```json
{
  "@prisma/client": "^6.13.0",
  "prisma": "^6.13.0"
}
```

### UI & Styling
```json
{
  "tailwindcss": "^3.4.1",
  "@radix-ui/react-*": "^1.x.x",
  "lucide-react": "^0.511.0",
  "framer-motion": "^12.12.1",
  "sonner": "^2.0.3"
}
```

### Development Tools
```json
{
  "@types/node": "20.17.47",
  "@types/react": "19.1.8",
  "@types/react-dom": "19.1.6",
  "autoprefixer": "^10.4.21",
  "postcss": "^8"
}
```

## ğŸŒ **Environment Variables**

### Database & Redis
```bash
DATABASE_URL="postgresql://username:password@localhost:5432/soapbox"
REDIS_HOST="localhost"
REDIS_PORT="6379"
REDIS_PASSWORD="your-redis-password"
```

### Blockchain RPCs (Client-accessible)
```bash
NEXT_PUBLIC_ALCHEMY1="your-alchemy-api-key-1"
NEXT_PUBLIC_ALCHEMY2="your-alchemy-api-key-2"
NEXT_PUBLIC_PIMLICO1="your-pimlico-api-key-1"
NEXT_PUBLIC_BASE_PRIVATE_RPC_URL="your-primary-rpc-url"
```

### API Keys & Services
```bash
OPENAI_API_KEY="your-openai-key"
EMPIRE_API_KEY="your-empire-api-key"
POSTHOG_PROJECT_ID="your-posthog-id"
POSTHOG_HOST="https://app.posthog.com"
```

## ğŸ¯ **Key Features**

- **ğŸ” Token-gated Access**: Vault-based authorization system
- **ğŸ’¬ Real-time Messaging**: XMTP + SpacetimeDB integration
- **ğŸ® Interactive Elements**: Games, tipping, rich media
- **ğŸ”§ Admin Controls**: Comprehensive moderation tools
- **âš¡ High Performance**: Redis caching for 500K-5M users
- **ğŸŒ Cross-platform**: Telegram, Discord, Slack integrations
- **ğŸ“Š Analytics**: Built-in monitoring and insights

## ğŸ§ª **Development Scripts**

```bash
npm run dev                 # Start development server
npm run build              # Production build
npm run start              # Start production server
npm run lint               # ESLint checking
npm run test               # Run test suite
npm run deps:analyze       # Analyze dependencies
npm run build:analyze      # Bundle size analysis
```

## ğŸ—‚ï¸ **Database Schema**

The application uses PostgreSQL with the following core entities:

- **EmpireRoom**: Chat rooms tied to Empire vaults
- **ChatMessage**: Persistent message storage with moderation
- **DirectMessage**: Private messaging between users
- **RoomSettings**: Configurable room parameters
- **TokenCache**: Token information caching
- **AuthorizedAddressCache**: Vault authorization caching
- **ModerationAudit**: Moderation action tracking

## ğŸ›ï¸ **SpacetimeDB Integration**

SpacetimeDB provides real-time, decentralized data synchronization with:

- **Tables**: Users, Rooms, Messages, Vaults, Fees
- **Reducers**: Server-side business logic in Rust
- **Real-time Subscriptions**: Live data updates
- **Decentralized Compute**: Database-embedded logic

## ğŸ¨ **UI/UX Framework**

Built with a comprehensive design system:

- **50+ Shadcn/ui components** (buttons, forms, dialogs, etc.)
- **Radix UI primitives** for accessibility
- **Tailwind CSS** for styling
- **Dark/light mode support**
- **Mobile-responsive design**
- **Error boundaries** for stability

## ğŸ”§ **Service Architecture**

Modular service layer with:

- **Authentication**: JWT + wallet-based auth
- **Empire API**: Decentralized model integration
- **Token Resolution**: Base token information
- **Moderation**: Software + AI-powered content filtering
- **Analytics**: PostHog integration
- **Caching**: Multi-layer Redis caching

## ğŸš¨ **Production Considerations**

- **Environment Variables**: Secure all API keys
- **Database**: Set up PostgreSQL with proper indices
- **Redis**: Configure for high availability
- **RPC Endpoints**: Use private/authenticated RPCs
- **Monitoring**: Enable PostHog analytics
- **Error Handling**: Comprehensive error boundaries

## ğŸ“– **Additional Resources**

- **XMTP Docs**: https://docs.xmtp.org/
- **SpacetimeDB Docs**: https://spacetimedb.com/docs
- **Wagmi Docs**: https://wagmi.sh/
- **Prisma Docs**: https://www.prisma.io/docs
- **Base Docs**: https://docs.base.org/

---

**Happy Building! ğŸš€**